<!DOCTYPE html>
<html>
<head>
  <title>Sentence Repetition</title>
  <style>
    body { font-family: Arial; background:#f4f6f8; padding:40px; }
    .box { max-width:600px; margin:auto; background:white; padding:20px; border-radius:10px; }
    button { padding:10px 15px; margin:5px; }
    #sentence { font-size:18px; margin:15px 0; }
  </style>
</head>
<body>

<div class="box">
  <h2>Sentence Repetition</h2>

  <button onclick="getSentence()">Get Sentence</button>
  <button onclick="listenSentence()">Listen</button>

  <p id="sentence">Click "Get Sentence"</p>

  <hr>

  <button onclick="startRecording()">Start Recording</button>
  <button onclick="stopRecording()">Stop Recording</button>

  <audio id="audio" controls></audio>
</div>

<script>
const API = "https://communication-backend-5pk0.onrender.com";
let currentSentence = "";
let recorder;
let audioChunks = [];

/* 1️⃣ Get sentence from backend */
function getSentence() {
  fetch(API + "/api/sentence", {
    headers: {
      "Authorization": localStorage.getItem("token")
    }
  })
  .then(res => res.json())
  .then(data => {
    currentSentence = data.sentence;
    document.getElementById("sentence").innerText = currentSentence;
  });
}

/* 2️⃣ Listen (Text-to-Speech) */
function listenSentence() {
  if (!currentSentence) return alert("Get sentence first");
  const speech = new SpeechSynthesisUtterance(currentSentence);
  speech.lang = "en-US";
  window.speechSynthesis.speak(speech);
}

/* 3️⃣ Record student voice */
async function startRecording() {
  audioChunks = [];
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  recorder = new MediaRecorder(stream);

  recorder.ondataavailable = e => audioChunks.push(e.data);
  recorder.onstop = () => {
    const audioBlob = new Blob(audioChunks);
    const audioUrl = URL.createObjectURL(audioBlob);
    document.getElementById("audio").src = audioUrl;
  };

  recorder.start();
}

/* 4️⃣ Stop recording */
function stopRecording() {
  recorder.stop();
}
</script>

</body>
</html>
